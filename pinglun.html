<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>评论区</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- 配置Tailwind自定义颜色 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .backdrop-blur {
                backdrop-filter: blur(4px);
            }
            .modal-enter {
                animation: modalEnter 0.2s ease-out forwards;
            }
            .modal-exit {
                animation: modalExit 0.2s ease-in forwards;
            }
            .fade-in {
                animation: fadeIn 0.2s ease-out forwards;
            }
        }
        
        @keyframes modalEnter {
            from { 
                opacity: 0;
                transform: scale(0.95);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes modalExit {
            from { 
                opacity: 1;
                transform: scale(1);
            }
            to { 
                opacity: 0;
                transform: scale(0.95);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>

<body class="bg-gray-100 font-sans min-h-screen flex items-center justify-center p-4">
    <!-- 触发按钮 -->
    <button id="openCommentBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-md transition-colors">
        <i class="fa fa-comments-o mr-1"></i> 评论
    </button>

    <!-- 评论弹窗背景 -->
    <div id="commentModalOverlay" class="fixed inset-0 bg-black/50 backdrop-blur z-40 hidden fade-in"></div>

    <!-- 评论弹窗 -->
    <div id="commentModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] flex flex-col modal-enter">
            <!-- 弹窗头部 -->
            <div class="border-b border-gray-200 px-5 py-3 flex justify-between items-center">
                <h2 class="font-medium">评论区</h2>
                <button id="closeCommentBtn" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>

            <!-- 弹窗内容区 -->
            <div class="flex-1 overflow-y-auto px-5 py-3" id="commentsContent">
                <!-- 评论输入框 -->
                <div class="mb-5">
                    <textarea id="commentInput" rows="2" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary focus:border-primary outline-none resize-none" placeholder="添加评论..."></textarea>
                    <div class="flex justify-end mt-2">
                        <button id="submitComment" class="bg-primary hover:bg-primary/90 text-white text-sm px-3 py-1.5 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            发送
                        </button>
                    </div>
                </div>

                <!-- 评论列表 -->
                <div id="commentsList" class="space-y-4">
                    <!-- 评论1 -->
                    <div class="pb-4 border-b border-gray-100">
                        <div class="flex items-start">
                            <img src="https://picsum.photos/id/64/40/40" alt="用户头像" class="w-7 h-7 rounded-full mr-2">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center mb-1">
                                    <span class="text-sm font-medium mr-2">张明</span>
                                    <span class="text-xs text-gray-500">昨天</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-2">
                                    好
                                </p>
                                <button class="text-xs text-primary hover:text-primary/80 reply-btn">回复</button>

                                <!-- 回复区 -->
                                <div class="mt-3 pl-3 border-l-2 border-gray-100 space-y-3 replies-container">
                                    <div class="reply-input-container hidden">
                                        <textarea rows="2" class="w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:ring-1 focus:ring-primary focus:border-primary outline-none resize-none" placeholder="回复张明..."></textarea>
                                        <div class="flex justify-end mt-1 gap-2">
                                            <button class="cancel-reply text-xs px-2 py-1 border border-gray-300 rounded hover:bg-gray-50">取消</button>
                                            <button class="submit-reply text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90">回复</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- 评论2 -->
                    <div>
                        <div class="flex items-start">
                            <img src="https://picsum.photos/id/177/40/40" alt="用户头像" class="w-7 h-7 rounded-full mr-2">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center mb-1">
                                    <span class="text-sm font-medium mr-2">王芳</span>
                                    <span class="text-xs text-gray-500">1周前</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-2">
                                    666
                                </p>
                                <button class="text-xs text-primary hover:text-primary/80 reply-btn">回复</button>

                                <div class="mt-3 pl-3 border-l-2 border-gray-100 space-y-3 replies-container">
                                    <div class="reply-input-container hidden">
                                        <textarea rows="2" class="w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:ring-1 focus:ring-primary focus:border-primary outline-none resize-none" placeholder="回复王芳..."></textarea>
                                        <div class="flex justify-end mt-1 gap-2">
                                            <button class="cancel-reply text-xs px-2 py-1 border border-gray-300 rounded hover:bg-gray-50">取消</button>
                                            <button class="submit-reply text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90">回复</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 加载更多 -->
                <div class="mt-4 text-center">
                    <button id="loadMore" class="text-sm text-gray-600 hover:text-gray-800 px-3 py-1.5 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                        加载更多
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const openCommentBtn = document.getElementById('openCommentBtn');
        const closeCommentBtn = document.getElementById('closeCommentBtn');
        const commentModal = document.getElementById('commentModal');
        const commentModalOverlay = document.getElementById('commentModalOverlay');
        const commentInput = document.getElementById('commentInput');
        const submitComment = document.getElementById('submitComment');
        const commentsList = document.getElementById('commentsList');
        const loadMoreBtn = document.getElementById('loadMore');
        
        // 打开评论弹窗
        function openCommentModal() {
            commentModalOverlay.classList.remove('hidden');
            commentModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // 防止背景滚动
        }
        
        // 关闭评论弹窗
        function closeCommentModal() {
            // 添加退出动画
            const modalContent = commentModal.querySelector('.modal-enter');
            modalContent.classList.remove('modal-enter');
            modalContent.classList.add('modal-exit');
            
            setTimeout(() => {
                commentModalOverlay.classList.add('hidden');
                commentModal.classList.add('hidden');
                document.body.style.overflow = ''; // 恢复背景滚动
                modalContent.classList.remove('modal-exit');
                modalContent.classList.add('modal-enter');
            }, 200);
        }
        
        // 绑定打开/关闭事件
        openCommentBtn.addEventListener('click', openCommentModal);
        closeCommentBtn.addEventListener('click', closeCommentModal);
        commentModalOverlay.addEventListener('click', closeCommentModal);
        
        // 按ESC键关闭弹窗
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !commentModal.classList.contains('hidden')) {
                closeCommentModal();
            }
        });
        
        // 评论输入框处理
        commentInput.addEventListener('input', function() {
            if (this.value.trim().length > 0) {
                submitComment.removeAttribute('disabled');
            } else {
                submitComment.setAttribute('disabled', 'true');
            }
        });
        
        // 提交评论
        submitComment.addEventListener('click', function() {
            const content = commentInput.value.trim();
            if (content.length === 0) return;
            
            // 创建新评论元素
            const newComment = createCommentElement(
                'https://picsum.photos/id/1005/40/40',
                '我',
                '刚刚',
                content
            );
            
            // 添加到评论列表顶部
            commentsList.insertBefore(newComment, commentsList.firstChild);
            
            // 添加边框分隔符（如果不是唯一评论）
            if (commentsList.children.length > 1) {
                newComment.classList.add('pb-4', 'border-b', 'border-gray-100');
            }
            
            // 重置输入框
            commentInput.value = '';
            submitComment.setAttribute('disabled', 'true');
            
            // 更新评论计数
            updateCommentCount(1);
            
            // 滚动到顶部查看新评论
            document.getElementById('commentsContent').scrollTop = 0;
        });
        
        // 创建评论元素
        function createCommentElement(avatarUrl, username, date, content) {
            const commentDiv = document.createElement('div');
            commentDiv.innerHTML = `
                <div class="flex items-start">
                    <img src="${avatarUrl}" alt="用户头像" class="w-7 h-7 rounded-full mr-2">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center mb-1">
                            <span class="text-sm font-medium mr-2">${username}</span>
                            <span class="text-xs text-gray-500">${date}</span>
                        </div>
                        <p class="text-sm text-gray-700 mb-2">${content}</p>
                        <button class="text-xs text-primary hover:text-primary/80 reply-btn">回复</button>
                        
                        <div class="mt-3 pl-3 border-l-2 border-gray-100 space-y-3 replies-container">
                            <div class="reply-input-container hidden">
                                <textarea rows="2" class="w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:ring-1 focus:ring-primary focus:border-primary outline-none resize-none" placeholder="回复${username}..."></textarea>
                                <div class="flex justify-end mt-1 gap-2">
                                    <button class="cancel-reply text-xs px-2 py-1 border border-gray-300 rounded hover:bg-gray-50">取消</button>
                                    <button class="submit-reply text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90">回复</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 绑定事件
            bindCommentEvents(commentDiv);
            return commentDiv;
        }
        
        // 绑定评论事件
        function bindCommentEvents(commentElement) {
            // 回复按钮事件
            const replyBtns = commentElement.querySelectorAll('.reply-btn, .reply-to-reply-btn');
            
            replyBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 隐藏所有回复框
                    document.querySelectorAll('.reply-input-container').forEach(container => {
                        container.classList.add('hidden');
                        container.querySelector('textarea').value = '';
                    });
                    
                    // 显示当前回复框
                    const repliesContainer = this.closest('.replies-container') || this.parentNode.querySelector('.replies-container');
                    const replyInput = repliesContainer.querySelector('.reply-input-container');
                    
                    if (replyInput) {
                        replyInput.classList.remove('hidden');
                        replyInput.querySelector('textarea').focus();
                    }
                });
            });
            
            // 取消回复
            const cancelReplyBtn = commentElement.querySelector('.cancel-reply');
            if (cancelReplyBtn) {
                cancelReplyBtn.addEventListener('click', function() {
                    this.closest('.reply-input-container').classList.add('hidden');
                    this.closest('.reply-input-container').querySelector('textarea').value = '';
                });
            }
            
            // 提交回复
            const submitReplyBtn = commentElement.querySelector('.submit-reply');
            if (submitReplyBtn) {
                submitReplyBtn.addEventListener('click', function() {
                    const replyContainer = this.closest('.reply-input-container');
                    const replyText = replyContainer.querySelector('textarea').value.trim();
                    
                    if (replyText) {
                        // 获取被回复的用户名
                        const usernameElement = this.closest('.replies-container').previousElementSibling.querySelector('.font-medium');
                        const username = usernameElement ? usernameElement.textContent : '用户';
                        
                        // 创建新回复
                        const newReply = createReplyElement(
                            'https://picsum.photos/id/1005/32/32',
                            '我',
                            '刚刚',
                            replyText
                        );
                        
                        // 添加到回复列表
                        replyContainer.parentNode.insertBefore(newReply, replyContainer);
                        
                        // 重置回复框
                        replyContainer.querySelector('textarea').value = '';
                        replyContainer.classList.add('hidden');
                        
                        // 绑定事件
                        bindCommentEvents(newReply);
                    }
                });
            }
        }
        
        // 创建回复元素
        function createReplyElement(avatarUrl, username, date, content) {
            const replyDiv = document.createElement('div');
            replyDiv.className = 'flex items-start';
            replyDiv.innerHTML = `
                <img src="${avatarUrl}" alt="回复用户头像" class="w-6 h-6 rounded-full mr-2">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center mb-1">
                        <span class="text-xs font-medium mr-2">${username}</span>
                        <span class="text-xs text-gray-500">${date}</span>
                    </div>
                    <p class="text-xs text-gray-700 mb-2">${content}</p>
                    <button class="text-xs text-primary hover:text-primary/80 reply-to-reply-btn">回复</button>
                </div>
            `;
            return replyDiv;
        }
        
        // 为现有评论绑定事件
        document.querySelectorAll('#commentsList > div').forEach(comment => {
            bindCommentEvents(comment);
        });
        
        // 加载更多评论
        loadMoreBtn.addEventListener('click', function() {
            const btn = this;
            btn.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i> 加载中';
            btn.disabled = true;
            
            // 模拟加载延迟
            setTimeout(() => {
                // 添加2条模拟评论
                const comments = [
                    
                ];
                
                comments.forEach((comment, index) => {
                    const commentElement = createCommentElement(
                        comment.avatar,
                        comment.name,
                        comment.date,
                        comment.content
                    );
                    
                    // 除了最后一个评论，都添加分隔线
                    if (index < comments.length - 1) {
                        commentElement.classList.add('pb-4', 'border-b', 'border-gray-100');
                    }
                    
                    commentsList.appendChild(commentElement);
                });
                
                // 恢复按钮状态
                btn.innerHTML = '加载更多';
                btn.disabled = false;
                
                // 更新评论计数
                updateCommentCount(2);
            }, 800);
        });
        
        // 更新评论计数
        function updateCommentCount(change) {
            const countElement = document.querySelector('#commentModal h2');
            const currentCount = parseInt(countElement.textContent.match(/\d+/)[0]);
            const newCount = currentCount + change;
            countElement.textContent = `评论 (${newCount})`;
        }
    </script>
</body>

</html>
